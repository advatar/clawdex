version: 1
services:
  - name: clawdex-gateway
    owner: clawdex
    description: HTTP gateway for OpenClaw-compatible routing.
    command: clawdex gateway --bind 127.0.0.1:18789
    ports:
      - name: http
        port: 18789
        protocol: http
    health: none
    dependencies:
      - state_dir
      - workspace_dir
  - name: clawdex-daemon
    owner: clawdex
    description: Daemon runtime exposing HTTP admin/task APIs plus local Unix socket JSON-RPC IPC (`daemon.request`).
    command: clawdexd --bind 127.0.0.1:18791 --ipc-uds ~/.codex/clawdex/daemon.sock
    ports:
      - name: http
        port: 18791
        protocol: http
    sockets:
      - name: ipc
        path: ~/.codex/clawdex/daemon.sock
        protocol: jsonrpc
    health: /v1/health
    dependencies:
      - state_dir
      - workspace_dir
      - codex_bin
  - name: clawdex-task-server
    owner: clawdex
    description: Legacy task HTTP server (CLI/debug path).
    command: clawdex tasks server --bind 127.0.0.1:18790
    ports:
      - name: http
        port: 18790
        protocol: http
    health: none
    dependencies:
      - state_dir
      - workspace_dir
  - name: macclawdex-app
    owner: macClawdex
    description: SwiftUI macOS app shell. Publishes MBP2P peer-assist events with multi-relay bootstrap, decentralized discovery, and fallback publish attempts (manual `/peers` plus optional auto triggers for second-opinion/stuck/discussion cadence). Plugin Manager supports installed plugin/skill search plus OpenClawHub discovery, and passes bundled Claude plugin path to clawdex runtime for first-run auto-install.
    command: Clawdex.app (Xcode scheme: Clawdex)
    ports: []
    health: none
    dependencies:
      - clawdex-daemon
      - clawdex-gateway
      - /Volumes/XCodeX/Antenna/swift/AntennaProtocol
      - antenna-relay
      - user_configured_primary_antenna_relay_http_endpoint
      - optional_user_configured_antenna_bootstrap_relays
  - name: antenna-relay
    owner: antenna
    description: Deployable Rust relay/discovery node for MBP2P envelopes with gossip discovery and rendezvous replication.
    command: cargo run --manifest-path /Volumes/XCodeX/Antenna/rust/antenna-relay/Cargo.toml -- --bind 127.0.0.1:7878 --public-url http://127.0.0.1:7878
    ports:
      - name: http
        port: 7878
        protocol: http
    health: /v1/health
    dependencies:
      - outbound_http_to_bootstrap_relays
